-- used for checking heat pump data.
-- The main_heating_details node contains an array that can contain 1 or 2 items.
-- The query expands this array so that you can get the main_heating_index_number out of both if 2 are present.

SELECT
    assessment_id,
    assessment_type,
    score,
    main_heating_index_number,
    eer
FROM
    (SELECT
         assessment_id,
         (document ->> 'assessment_type')::varchar as assessment_type,
         (document ->> 'energy_rating_current') as score,
         (json_array_elements((document -> 'sap_heating' -> 'main_heating_details')::json) ->> 'main_heating_index_number')::integer as main_heating_index_number,
         energy_band_calculator((document ->> 'energy_rating_current')::int, document ->> 'assessment_type' ) as eer
     FROM assessment_documents) a
WHERE assessment_type IN ('RdSAP', 'SAP')
AND  main_heating_index_number IN  (106087,106088,106089,106090,103998,103999,104000,104001,104002,104003,104004,104005,104439,104440,104441,104442,104443,104444,104445,104446,104958,104959,104960,104961,104962,104963,104964,104965,106958,106959,106960,106961,106962,106963,106964,106965,105506,105507,105508,105509,105510,105511,105512,105513,105544,105545,105546,105547,105548,105549,105550,105551,105552,105553,105554,105555,105556,105557,105558,105559,105560,105561,105562,105563,105680,105681,105682,105683,105684,105685,105686,105687,105688,105689,105690,105691,105692,105693,105694,105695,105696,105697,105698,105699,105700,105701,105702,105703,105704,105705,105706,105707,105708,105709,105710,105711,105712,105713,105714,105715,105716,105717,105718,105719,105983,105984,105985,105986,105987,105988,105989,105990,105991,105992,105993,105994,105995,105996,105997,105998,105999,106000,106001,106002,106003,106004,106005,106006,106620,106621,106622,106623,106688,106689,106690,106691,106692,106693,106694,106695,107008,107009,107010,107011,107012,107013,107014,107015,103934,103935,103936,103937,103938,103939,103940,103941);
